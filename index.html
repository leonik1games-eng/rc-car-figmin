<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RC Car - COLLIDER FORÃ‡ADO</title>
  <meta name="figmin">
  <!-- Mesmo CSS -->
</head>
<body>
  <!-- Mesmo layout -->
  <div id="status">Aguardando...</div>
  <div id="debug"></div>
  <div id="output">Vel: 0 | Acel: 0 | Collider: --</div>
  <!-- controles -->

  <script>
    var car = null;

    document.addEventListener("FigminReady", function() {
      if (!figmin.isSpatialApp()) figmin.requireSpatialApp();
      
      car = figmin.findObjectByName("meu_carro");
      if (car) setupCar();
    });

    function setupCar() {
      // *** PASSO 1: FORÃ‡A COLLIDER BOX (tamanho automÃ¡tico) ***
      car.colliderType = figmin.ColliderType.BOX; // BOX simples [web:1]

      // *** PASSO 2: FÃSICA ULTRA LEVE ***
      car.addComponent(figmin.ComponentType.PHYSICS, {
        mass: 0.05,        // PLUMA
        drag: 0.0,         // SEM AR
        angularDrag: 0.1,
        gravityStrength: 0.3,
        kinematic: true
      });

      car.addComponent(figmin.ComponentType.PHYSICS_MATERIAL, {
        bounciness: 0.0,
        staticFriction: 0.0,  // ZERO ATRITO
        dynamicFriction: 0.0
      });

      figmin.enableInputConnect("RC Car", [
        figmin.InputCode.SELECT_RIGHT,
        figmin.InputCode.AXIS_Y_RIGHT,
        figmin.InputCode.AXIS_X_LEFT,
        figmin.InputCode.THUMB_RIGHT
      ], onInputConnectionChanged, car);

      figmin.setUpdateFunction(update);
      document.getElementById("status").innerText = "âœ… Collider BOX + FÃ­sica OK";
    }

    function onInputConnectionChanged(connected) {
      if (connected && car.physics) {
        car.physics.kinematic = false;
        document.getElementById("status").innerText = "ðŸš— SOLTO! Acelera!";
      }
    }

    function update(dt) {
      if (!car?.physics) return;

      var accelIn = figmin.getInput(figmin.InputCode.SELECT_RIGHT);
      var v = car.physics.velocity;
      var speed = Math.sqrt(v.x*v.x + v.y*v.y + v.z*v.z);

      // DEBUG COMPLETO
      document.getElementById("output").innerText = 
        `Vel: ${speed.toFixed(2)} | Acel: ${accelIn.toFixed(2)} | Collider: ${car.colliderType}`;

      document.getElementById("debug").innerText = 
        `Massa: ${car.physics.mass?.toFixed(2)} | Kin: ${car.physics.kinematic}`;

      if (accelIn > 0.05) {
        // FORÃ‡A INSANA no eixo Z LOCAL
        car.physics.applyForce({ x: 0, y: 0, z: 200 * dt }); // 200N!
      }
    }
  </script>
</body>
</html>
