<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SS Play RC - Clean</title>
    <meta name="figmin">
    <style>
        /* ESTILO LIMPO - Só o essencial */
        :root { --accent: #00ff00; --bg: #020617; --text: #e2e8f0; }
        body {
            font-family: system-ui, sans-serif;
            background: transparent; /* Invisível */
            color: var(--text);
            margin: 0;
            overflow: hidden;
            /* Garante que o laser atravesse tudo, menos os botões */
            pointer-events: none; 
        }

        /* Cartão de Instruções (Desaparece ao conectar se quiser) */
        .card {
            position: fixed;
            top: 20px; left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #333;
            max-width: 300px;
            pointer-events: auto; /* Permite clicar aqui */
        }
        h1 { margin: 0 0 10px; color: var(--accent); font-size: 18px; }
        .row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #333; font-size: 14px; }
        
        /* Botão de Config no canto inferior */
        .config-btn {
            position: fixed; bottom: 20px; right: 20px;
            background: var(--accent); color: #000;
            padding: 10px 20px; border-radius: 30px;
            font-weight: bold; cursor: pointer; border: none;
            pointer-events: auto;
            z-index: 999;
        }

        /* Painel de Configuração */
        #configPanel {
            display: none; position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: #1e293b; padding: 20px; border-radius: 15px;
            width: 300px; z-index: 1000; border: 1px solid var(--accent);
            pointer-events: auto;
        }
        .slider-box { margin-bottom: 15px; }
        input[type=range] { width: 100%; accent-color: var(--accent); }
    </style>
</head>
<body>

    <div class="card" id="infoCard">
        <h1>SS PLAY RC</h1>
        <div class="row"><span>Conectar</span> <span>Clique no Raio ⚡</span></div>
        <div class="row"><span>Acelerar</span> <span>Gatilho R2</span></div>
        <div class="row"><span>Ré</span> <span>Analógico Baixo</span></div>
        <div class="row"><span>Reset</span> <span>Clique R3</span></div>
        <div id="status" style="margin-top:10px; color: yellow; font-size: 12px;">Procurando 'meu_carro'...</div>
    </div>

    <button class="config-btn" onclick="toggleConfig()">AJUSTES</button>

    <div id="configPanel">
        <h3 style="margin-top:0; color:white;">Ajuste Fino</h3>
        
        <div class="slider-box">
            <label style="color:white">Força Motor: <span id="valSpeed">150</span></label>
            <input type="range" id="sliderSpeed" min="50" max="300" step="10" value="150">
        </div>

        <div class="slider-box">
            <label style="color:white">Força Curva: <span id="valTurn">20</span></label>
            <input type="range" id="sliderTurn" min="5" max="50" step="1" value="20">
        </div>

        <div class="slider-box">
            <label style="color:white">Gravidade: <span id="valGrav">3.0</span></label>
            <input type="range" id="sliderGrav" min="1.0" max="10.0" step="0.5" value="3.0">
        </div>
        
        <div class="slider-box">
            <label style="color:white; display:flex; align-items:center;">
                <input type="checkbox" id="checkAxis" style="width:20px; height:20px;"> 
                <span style="margin-left:10px">Inverter Eixo (Lado)</span>
            </label>
        </div>

        <button onclick="toggleConfig()" style="width:100%; padding:10px; background:#000; color:#fff; border:none; cursor:pointer;">FECHAR</button>
    </div>

    <script>
        // --- VARIÁVEIS GLOBAIS ---
        let car = null;
        let isConnected = false;

        // Referências aos Sliders
        const sliderSpeed = document.getElementById('sliderSpeed');
        const sliderTurn = document.getElementById('sliderTurn');
        const sliderGrav = document.getElementById('sliderGrav');
        const checkAxis = document.getElementById('checkAxis');
        
        // Atualiza números na tela ao mexer no slider
        sliderSpeed.oninput = () => document.getElementById('valSpeed').innerText = sliderSpeed.value;
        sliderTurn.oninput = () => document.getElementById('valTurn').innerText = sliderTurn.value;
        sliderGrav.oninput = () => {
            document.getElementById('valGrav').innerText = sliderGrav.value;
            if(car && car.physics) car.physics.gravityStrength = parseFloat(sliderGrav.value);
        };

        function toggleConfig() {
            const p = document.getElementById('configPanel');
            p.style.display = p.style.display === 'block' ? 'none' : 'block';
        }

        // --- INICIALIZAÇÃO ---
        document.addEventListener("FigminReady", init);

        function init() {
            if (!figmin.isSpatialApp()) { figmin.requireSpatialApp(); return; }

            car = figmin.findObjectByName("meu_carro");

            if (!car) {
                document.getElementById("status").innerText = "ERRO: Renomeie o objeto 3D para 'meu_carro'";
                document.getElementById("status").style.color = "red";
                setTimeout(init, 2000); // Tenta de novo
                return;
            }

            document.getElementById("status").innerText = "Pronto! Aponte para o carro.";
            document.getElementById("status").style.color = "#00ff00";

            // CONFIGURAÇÃO INICIAL DE FÍSICA
            setupPhysics(car);

            // CRIA O RAIO DE CONEXÃO
            figmin.enableInputConnect("Pilotar", [
                figmin.InputCode.SELECT_RIGHT,
                figmin.InputCode.AXIS_Y_RIGHT,
                figmin.InputCode.AXIS_X_RIGHT,
                figmin.InputCode.THUMB_RIGHT
            ], onConnect, car);

            figmin.setUpdateFunction(update);
        }

        function setupPhysics(obj) {
            // Física "Pesada" para RC (pra não voar)
            obj.addComponent(figmin.ComponentType.PHYSICS, {
                mass: 8.0,            // Bem pesado
                drag: 2.0,            // Freia rápido ao soltar (como motor elétrico)
                angularDrag: 4.0,     // Estável nas curvas
                gravityStrength: 3.0, // Gravidade 3x pra colar no chão
                collisionDetectionMode: figmin.physics.CollisionDetectionMode.CONTINUOUS_DYNAMIC,
                kinematic: false
            });

            // Pneus
            obj.addComponent(figmin.ComponentType.PHYSICS_MATERIAL, {
                bounciness: 0.0,      // Zero quique
                staticFriction: 0.5,  // Atrito médio
                dynamicFriction: 0.4
            });
        }

        function onConnect(connected) {
            isConnected = connected;
            const status = document.getElementById("status");
            
            if (connected) {
                status.innerText = "CONECTADO!";
                // Acorda a física
                if(car.physics) {
                    car.physics.kinematic = false;
                    car.physics.wakeUp();
                }
            } else {
                status.innerText = "Desconect
