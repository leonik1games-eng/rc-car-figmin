<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RC Car DEBUG FÍSICA</title>
  <meta name="figmin">
  <!-- CSS igual ao anterior, vou pular pra economizar espaço -->
  <style>/* Mesmo CSS de antes */</style>
</head>
<body>
  <!-- Mesmo HTML de antes -->
  <div class="card">
    <h1>RC Car DEBUG</h1>
    <div id="status">Aguardando...</div>
    <div id="debug">Massa: -- | Atrito: --</div>
    <!-- controles iguais -->
    <div id="output">Vel: 0.00 | Acel: 0.00</div>
  </div>

  <script>
    var car = null;

    document.addEventListener("FigminReady", function() {
      if (!figmin.isSpatialApp()) { figmin.requireSpatialApp(); return; }

      car = figmin.findObjectByName("meu_carro");
      if (car) {
        setupCar();
      }
    });

    function setupCar() {
      // FÍSICA SUPER LEVE pra testar
      car.addComponent(figmin.ComponentType.PHYSICS, {
        mass: 0.1,        // MUITO LEVE
        drag: 0.01,       // SEM AR
        angularDrag: 0.1,
        gravityStrength: 0.5, // GRAVIDADE FRACA
        kinematic: true
      });

      car.addComponent(figmin.ComponentType.PHYSICS_MATERIAL, {
        bounciness: 0.0,
        staticFriction: 0.1,   // ATRITO MÍNIMO
        dynamicFriction: 0.05  // QUASE ZERO
      });

      figmin.enableInputConnect("RC Car", [
        figmin.InputCode.SELECT_RIGHT,
        figmin.InputCode.AXIS_Y_RIGHT,
        figmin.InputCode.AXIS_X_LEFT,
        figmin.InputCode.THUMB_RIGHT
      ], onInputConnectionChanged, car);

      figmin.setUpdateFunction(update);
    }

    function onInputConnectionChanged(connected) {
      if (connected && car.physics) {
        car.physics.kinematic = false; // SOLTA DEFINITIVO
        document.getElementById("status").innerText = "✅ SOLTO! Acelera!";
      }
    }

    function update(dt) {
      if (!car?.physics) return;

      var accelIn = figmin.getInput(figmin.InputCode.SELECT_RIGHT);
      var v = car.physics.velocity;
      var speed = Math.sqrt(v.x*v.x + v.y*v.y + v.z*v.z);

      // DEBUG no HUD
      document.getElementById("output").innerText = 
        `Vel: ${speed.toFixed(2)} | Acel: ${accelIn.toFixed(2)} | Kin: ${car.physics.kinematic}`;

      // FORÇA ENORME pra garantir movimento
      if (accelIn > 0.1) {
        car.physics.applyForce({ x: 0, y: 0, z: 100 * dt }); // 100N = MUITO FORTE!
      }

      // Debug massa/atrito no card
      document.getElementById("debug").innerText = 
        `Massa: ${car.physics.mass?.toFixed(1)} | Atrito: ${car.physicsMaterial?.dynamicFriction || 'N/A'}`;
    }
  </script>
</body>
</html>
