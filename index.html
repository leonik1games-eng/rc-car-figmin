<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SS Play RC - Final Stable</title>
    <meta name="figmin">
    <style>
        body {
            background: transparent;
            font-family: sans-serif;
            text-align: center;
            overflow: hidden;
            margin: 0;
            pointer-events: none;
        }
        .hud {
            position: fixed; top: 20px; left: 20px;
            background: rgba(10, 10, 10, 0.95);
            border: 2px solid #00ff00;
            color: #fff;
            padding: 20px;
            border-radius: 15px;
            text-align: left;
            pointer-events: auto;
            width: 300px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .stat { color: #fff; font-weight: bold; font-size: 16px; }
        .controls { margin-top: 15px; font-size: 14px; color: #ccc; line-height: 1.6; }
        b { color: #fff; }
    </style>
</head>
<body>

    <div class="hud">
        <h3 style="margin:0; color:#00ff00;">SS PLAY RC <span style="font-size:12px; color:#fff;">vFinal</span></h3>
        <div id="status" class="stat">Carregando...</div>
        <hr style="border-color:#333">
        <div class="controls">
            üëâ <b>R2 (Gatilho Dir):</b> Acelerar<br>
            üëà <b>L2 (Gatilho Esq):</b> R√© / Freio<br>
            üïπÔ∏è <b>Anal√≥gico:</b> Dire√ß√£o<br>
            üõë <b>Bot√£o A:</b> Resetar
        </div>
    </div>

    <script>
        // --- AJUSTES ---
        const FORCA_MOTOR = 80.0;
        const VEL_CURVA = 3.5;
        const PESO = 3.0;
        
        // Se o carro andar de lado, mude para true
        const MODELO_DE_LADO = false; 
        // ---------------

        // --- MATEM√ÅTICA DE VETOR (Do Avi√£o) ---
        function quaternionMultiply(q1, q2) {
            return {
                w: q1.w * q2.w - q1.x * q2.x - q1.y * q2.y - q1.z * q2.z,
                x: q1.w * q2.x + q1.x * q2.w + q1.y * q2.z - q1.z * q2.y,
                y: q1.w * q2.y - q1.x * q2.z + q1.y * q2.w + q1.z * q2.x,
                z: q1.w * q2.z + q1.x * q2.y - q1.y * q2.x + q1.z * q2.w
            };
        }
        function quaternionConjugate(q) { return { w: q.w, x: -q.x, y: -q.y, z: -q.z }; }
        function quaternionRotateVector(q, v) {
            var qv = { w: 0, x: v.x, y: v.y, z: v.z };
            var qConj = quaternionConjugate(q);
            var q1 = quaternionMultiply(q, qv);
            var q2 = quaternionMultiply(q1, qConj);
            return { x: q2.x, y: q2.y, z: q2.z };
        }

        // --- CONEX√ÉO (SEU C√ìDIGO) ---
        var car = null;
        var statusDiv = document.getElementById("status");

        document.addEventListener("FigminReady", function() {
            car = figmin.findObjectByName("meu_carro");
            
            if (car) {
                statusDiv.innerText = "PRONTO! ‚ö°";
                statusDiv.style.color = "#00ff00";
                setupCar();
            } else {
                statusDiv.innerText = "ERRO: Cad√™ 'meu_carro'?";
                statusDiv.style.color = "red";
            }
        });
        // ---------------------------

        function setupCar() {
            car.addComponent(figmin.ComponentType.PHYSICS, {
                mass: PESO,           
                drag: 2.0,            
                angularDrag: 4.0,     
                gravityStrength: 1.0, 
                kinematic: false      
            });

            figmin.enableInputConnect("Controle RC", [
                figmin.InputCode.SELECT_RIGHT, // R2
                figmin.InputCode.SELECT_LEFT,  // L2
                figmin.InputCode.AXIS_X_RIGHT, // Dire√ß√£o
                figmin.InputCode.BUTTON_1      // Reset
            ], onConnect, car);

            figmin.setUpdateFunction(update);
        }

        function onConnect(connected) {
            statusDiv.innerText = connected ? "PILOTANDO!" : "Desconectado";
            statusDiv.style.color = connected ? "#00ff00" :
