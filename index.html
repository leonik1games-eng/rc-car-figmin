<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="figmin">
    <title>SS Play RC - Ghost</title>
    <style>
        /* FORÇA BRUTA PARA FICAR INVISÍVEL */
        html, body {
            background-color: transparent !important;
            background: rgba(0,0,0,0) !important;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none; /* Deixa o laser passar por tudo */
        }

        /* A única coisa visível: Um texto pequeno no canto */
        #debug {
            position: fixed;
            top: 20px;
            left: 20px;
            color: lime;
            font-family: monospace;
            font-size: 20px;
            background: rgba(0,0,0,0.5);
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="debug">AGUARDANDO CARREGAR...</div>

    <script>
        // --- CONFIGURAÇÕES FIXAS (Já que tiramos os menus) ---
        const MOTOR = 150.0;     // Força
        const CURVA = 30.0;      // Curva
        const GRAVIDADE = 3.0;   // Peso
        const INVERTER_EIXO = false; // Mude pra true se andar de lado
        // -----------------------------------------------------

        let car = null;
        let searchInterval = null;

        document.addEventListener("FigminReady", () => {
            if (!figmin.isSpatialApp()) {
                figmin.requireSpatialApp();
                return;
            }

            document.getElementById("debug").innerText = "PROCURANDO 'meu_carro'...";
            
            // RADAR: Tenta achar o carro a cada 1 segundo
            searchInterval = setInterval(searchCar, 1000);
        });

        function searchCar() {
            car = figmin.findObjectByName("meu_carro");

            if (car) {
                clearInterval(searchInterval); // Parar de procurar
                document.getElementById("debug").innerText = "ACHEI! CLIQUE NO RAIO ⚡";
                
                // Configurar Física Automaticamente
                setupCar();
            }
        }

        function setupCar() {
            // 1. Injeta Física
            car.addComponent(figmin.ComponentType.PHYSICS, {
                mass: 5.0,
                drag: 2.0,
                angularDrag: 4.0,
                gravityStrength: GRAVIDADE,
                collisionDetectionMode: figmin.physics.CollisionDetectionMode.CONTINUOUS_DYNAMIC,
                kinematic: false 
            });

            // 2. Injeta Material
            car.addComponent(figmin.ComponentType.PHYSICS_MATERIAL, {
                bounciness: 0.0,
                staticFriction: 0.6,
                dynamicFriction: 0.5
            });

            // 3. Ativa o Botão de Raio
            figmin.enableInputConnect("Pilotar RC", [
                figmin.InputCode.SELECT_RIGHT,
                figmin.InputCode.AXIS_Y_RIGHT,
                figmin.InputCode.AXIS_X_RIGHT,
                figmin.InputCode.THUMB_RIGHT
            ], onConnect, car);

            // 4. Inicia Loop
            figmin.setUpdateFunction(update);
        }

        function onConnect(connected) {
            const debug = document.getElementById("debug");
            if (connected) {
                debug.innerText = "CONECTADO: ACELERE (R2)";
                debug.style.color = "#00ff00";
                
                // Acorda o carro
                if(car.physics) {
                    car.physics.kinematic = false;
                    car.physics.wakeUp();
                }
            } else {
                debug.innerText = "DESCONECTADO";
                debug.style.color = "yellow";
            }
        }

        function update(dt) {
            if (!car || !car.physics) return;

            // Inputs
            let throttle = figmin.getInput(figmin.InputCode.SELECT_RIGHT);
            let steer = -figmin.getInput(figmin.InputCode.AXIS_X_RIGHT);
            let stickY = figmin.getInput(figmin.InputCode.AXIS_Y_RIGHT);
            let resetBtn = figmin.getInput(figmin.InputCode.THUMB_RIGHT);

            // Ré
            let isReversing = false;
            if (stickY < -0.2) {
                throttle = Math.abs(stickY);
                isReversing = true;
            }

            // Movimento
            let forward = car.transform.forward;
            let right = car.transform.right;
            let moveDir = INVERTER_EIXO ? right : forward;

            if (throttle > 0.05) {
                let direction = isReversing ? -1 : 1;
                let force = {
                    x: moveDir.x * throttle * MOTOR * direction * dt * 60,
                    y: moveDir.y * throttle * MOTOR * direction * dt * 60,
                    z: moveDir.z * throttle * MOTOR * direction * dt * 60
                };
                car.physics.applyForce(force);
            }

            if (Math.abs(steer) > 0.1) {
                car.physics.applyTorque({
                    x: 0,
                    y: steer * CURVA * dt * 60,
                    z: 0
                });
            }

            // Anti-Tombo
            if (car.transform.up.y < 0.5) {
                car.physics.applyTorque({ x: forward.x * 10, y: 0, z: forward.z * 10 });
            }

            // Reset
            if (resetBtn) doReset();
        }

        function doReset() {
            car.physics.setLinearVelocity({x:0, y:0, z:0});
            car.physics.setAngularVelocity({x:0, y:0, z:0});

            let cam = figmin.getCamera();
            let fwd = cam.transform.forward;
            let pos = cam.transform.position;

            car.transform.position = {
                x: pos.x + fwd.x * 2.0,
                y: pos.y - 0.5,
                z: pos.z + fwd.z * 2.0
            };
            if(car.transform.position.y < 0.2) car.transform.position.y = 0.5;
            car.transform.rotation = { x:0,
