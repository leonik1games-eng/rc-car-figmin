<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="figmin"> <title>SS Play Debug V2</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; font-size: 18px; text-align: center; }
        button { font-size: 24px; padding: 20px; background: #0f0; color: #000; border: none; cursor: pointer; margin: 20px; }
        .box { border: 2px solid #555; padding: 10px; margin: 10px; display: inline-block; width: 45%; }
        .val { font-size: 24px; font-weight: bold; color: white; }
    </style>
</head>
<body>

    <h1>TESTE DE CONTROLE</h1>
    
    <button id="btnStart" onclick="iniciarSistema()">CLIQUE AQUI PARA INICIAR</button>

    <div id="status">Aguardando clique...</div>

    <div class="box">
        Gatilho (Acelerar)<br>
        <span id="valTrigger" class="val">0.00</span>
    </div>
    
    <div class="box">
        Analógico (Direção)<br>
        <span id="valSteer" class="val">0.00</span>
    </div>

    <div class="box">
        Botões (Reset)<br>
        <span id="valBtn" class="val">---</span>
    </div>

    <p>Heartbeat: <span id="heartbeat">0</span></p>

    <script>
        let rodando = false;
        let car = null;
        let counter = 0;

        // Tenta conectar no Figmin (mas não trava se falhar)
        document.addEventListener("FigminReady", () => {
            car = figmin.findObjectByName("meu_carro");
            document.getElementById("status").innerText = car ? "CARRO CONECTADO!" : "CARRO NÃO ENCONTRADO (Verifique o nome)";
        });

        function iniciarSistema() {
            document.getElementById("btnStart").style.display = "none";
            document.getElementById("status").innerText = "SISTEMA RODANDO... MEXA O CONTROLE!";
            rodando = true;
            loop();
        }

        function loop() {
            if (!rodando) return;

            // 1. Contador visual (pra saber se o script tá vivo)
            counter++;
            document.getElementById("heartbeat").innerText = counter;

            // 2. Leitura dos Controles
            const gamepads = navigator.getGamepads();
            let gp = null;

            // Procura qualquer controle ativo
            for (let i = 0; i < 4; i++) {
                if (gamepads[i] && gamepads[i].buttons.length > 0) {
                    gp = gamepads[i];
                    break; 
                }
            }

            if (gp) {
                // --- ATUALIZA A TELA (DEBUG) ---
                
                // Gatilho (Botão 0 no Quest / 7 no Xbox)
                let trigger = gp.buttons[0] ? gp.buttons[0].value : 0;
                document.getElementById("valTrigger").innerText = trigger.toFixed(2);

                // Direção (Eixo 2 ou 0)
                let steer = gp.axes[2] || gp.axes[0] || 0;
                document.getElementById("valSteer").innerText = steer.toFixed(2);

                // Botão A/B (Reset)
                let btnA = gp.buttons[4] ? gp.buttons[4].pressed : false;
                let btnB = gp.buttons[1] ? gp.buttons[1].pressed : false; // As vezes B é 1
                
                if (btnA) document.getElementById("valBtn").innerText = "A (Press)";
                else if (btnB) document.getElementById("valBtn").innerText = "B (Press)";
                else document.getElementById("valBtn").innerText = "---";

                // --- COMANDO PRO CARRO ---
                if (car) {
                    let forward = car.getForwardVector();
                    // Simples pra teste: Acelera se gatilho > 0.1
                    if (trigger > 0.1) {
                         car.applyImpulse({
                            x: forward.x * trigger * 0.5,
                            y: forward.y * trigger * 0.5,
                            z: forward.z * trigger * 0.5
                        });
                    }
                    if (Math.abs(steer) > 0.1) {
                        car.setAngularVelocity({ x: 0, y: -steer * 3, z: 0 });
                    }
                }

            } else {
                document.getElementById("status").innerText = "NENHUM CONTROLE DETECTADO. APERTE BOTÕES!";
            }

            requestAnimationFrame(loop);
        }
    </script>
</body>
</html>
