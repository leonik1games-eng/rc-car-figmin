<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SS Play RC</title>
    <meta name="figmin">
    <style>
        /* VISUAL EXATO DO AVIÃO (AZUL ESCURO) */
        :root {
            --accent: #3b82f6;
            --bg: #020617;
            --text-muted: #9ca3af;
        }

        html, body {
            margin: 0; padding: 0; height: 100%; overflow: hidden;
            background-color: transparent; 
            font-family: system-ui, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .card {
            padding: 24px;
            border-radius: 20px;
            background: rgba(15, 23, 42, 0.95);
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            border: 1px solid rgba(148, 163, 184, 0.35);
            max-width: 400px;
            color: white;
        }

        h1 { margin: 0 0 10px; font-size: 24px; color: white; }
        .info { color: var(--text-muted); font-size: 14px; margin-bottom: 20px; }
        
        .status { 
            font-weight: bold; 
            padding: 10px; 
            border-radius: 8px; 
            background: #333; 
            color: yellow; 
        }
    </style>
</head>
<body>

    <div class="card">
        <h1>SS PLAY RC</h1>
        <div class="info">
            Aponte para o carro e clique no RAIO ⚡.<br>
            Use o Gatilho para acelerar.
        </div>
        <div id="status" class="status">Procurando 'meu_carro'...</div>
    </div>

    <script>
        // --- CONFIGURAÇÃO DE FÍSICA (CARRO) ---
        // Aumentei a força pra garantir que ele ande se for pesado
        const MOTOR = 200.0;
        const CURVA = 30.0;
        const GRAVIDADE = 3.0; // 3x gravidade normal pra colar no chão
        // --------------------------------------

        var car = null;
        var statusDiv = document.getElementById("status");

        // INICIALIZAÇÃO SIMPLES (IGUAL AO AVIÃO)
        document.addEventListener("FigminReady", init);

        function init() {
            // Garante modo AR
            if (!figmin.isSpatialApp()) {
                figmin.requireSpatialApp();
                return;
            }

            // Busca o objeto UMA VEZ.
            car = figmin.findObjectByName("meu_carro");

            if (car) {
                statusDiv.innerText = "CARRO ENCONTRADO! ⚡";
                statusDiv.style.color = "#4ade80"; // Verde
                setupCar();
            } else {
                statusDiv.innerText = "ERRO: Objeto 'meu_carro' não achado.";
                statusDiv.style.color = "red";
            }
        }

        function setupCar() {
            // 1. INJETA A FÍSICA (DYNAMIC)
            // Como você desligou no menu, aqui a gente liga via código.
            car.addComponent(figmin.ComponentType.PHYSICS, {
                mass: 8.0,            // 8kg (Pesado/Estável)
                drag: 2.0,            // Freio aerodinâmico (pra parar quando solta)
                angularDrag: 4.0,     // Pra não rodopiar
                gravityStrength: GRAVIDADE,
                collisionDetectionMode: figmin.physics.CollisionDetectionMode.CONTINUOUS_DYNAMIC,
                kinematic: false 
            });

            // 2. MATERIAL DE PNEU
            car.addComponent(figmin.ComponentType.PHYSICS_MATERIAL, {
                bounciness: 0.0,      // Sem quique
                staticFriction: 0.6,  // Atrito lateral
                dynamicFriction: 0.5
            });

            // 3. ATIVA O RAIO (INPUT CONNECT)
            figmin.enableInputConnect("Pilotar RC", [
                figmin.InputCode.SELECT_RIGHT,
                figmin.InputCode.AXIS_Y_RIGHT,
                figmin.InputCode.AXIS_X_RIGHT,
                figmin.InputCode.THUMB_RIGHT
            ], onConnect, car);

            // 4. LOOP DE CONTROLE
            figmin.setUpdateFunction(update);
        }

        function onConnect(connected) {
            if (connected) {
                statusDiv.innerText = "CONECTADO: PILOTANDO";
                statusDiv.style.background = "#064e3b";
                
                // Acorda a física (Garante que não tá dormindo)
                if(car.physics) {
                    car.physics.kinematic = false;
                    car.physics.wakeUp();
                }
            } else {
                statusDiv.innerText = "DESCONECTADO";
                statusDiv.style.background = "#333";
            }
        }

        function update(dt) {
            if (!car || !car.physics) return;

            // Inputs
            var throttle = figmin.getInput(figmin.InputCode.SELECT_RIGHT);
            var steer = -figmin.getInput(figmin.InputCode.AXIS_X_RIGHT);
            var stickY = figmin.getInput(figmin.InputCode.AXIS_Y_RIGHT);
            var resetBtn = figmin.getInput(figmin.InputCode.THUMB_RIGHT);

            // Ré
            var isReversing = false;
            if (stickY < -0.2) {
                throttle = Math.abs(stickY);
                isReversing = true;
            }

            var forward = car.transform.forward;
            var direction = isReversing ? -1 : 1;

            // Acelerar
            if (throttle > 0.05) {
                var forceX = forward.x * throttle * MOTOR * direction * dt * 60;
                var forceY = forward.y * throttle * MOTOR * direction * dt * 60;
                var forceZ = forward.z * throttle * MOTOR * direction * dt * 60;
                
                car.physics.applyForce({ x: forceX, y: forceY, z: forceZ });
            }

            // Curvar
            if (Math.abs(steer) > 0.1) {
                car.physics.applyTorque({
                    x: 0,
                    y: steer * CURVA * dt * 60,
                    z: 0
                });
            }

            // Estabilização (Anti-Tombo)
            if (car.transform.up.y < 0.5) {
                car.physics.applyTorque({ x: forward.x * 10, y: 0, z: forward.z * 10 });
            }

            // Reset
            if (resetBtn) doReset();
        }

        function doReset() {
            car.physics.setLinearVelocity({x:0, y:0, z:0});
            car.physics.setAngularVelocity({x:0, y:0, z:0});

            var cam = figmin.getCamera();
            var fwd = cam.transform.forward;
            var pos = cam.transform.position;

            // Teleporta
            car.transform.position = {
                x: pos.x + fwd.x * 2.0,
                y: pos.y - 0.5, 
                z: pos.z + fwd.z * 2.0
            };
            
            if(car.transform.position.y < 0.2) car.transform.position.y = 0.5;
            car.transform.rotation = { x:0, y: cam.transform.rotation.y, z:0 };
        }
    </script>
</body>
</html>
